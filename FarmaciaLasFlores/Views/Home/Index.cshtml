@{
    ViewData["Title"] = "Home Page";
    var permisos = ViewBag.Permisos as List<string> ?? new List<string>();
}

<style>
    body {
        background-color: #ede6e9;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #171d18;
        margin: 0;
    }

    .container {
        padding-top: 50px;
    }

    h1.display-4 {
        color: #1b3488;
        margin-bottom: 2rem;
    }

    .row {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }

    .col-md-6, .col-lg-4 {
        display: flex;
        justify-content: center;
        margin-bottom: 1rem;
    }

    .card {
        border: none;
        border-radius: 10px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .card:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

    .btn {
        width: 100%;
        padding: 1rem;
        font-size: 1.1rem;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background-color: #1b3488;
        border-color: #1b3488;
    }

        .btn-primary:hover {
            background-color: #7583a0;
            border-color: #7583a0;
        }

    .btn-success {
        background-color: #8ba22e;
        border-color: #8ba22e;
    }

        .btn-success:hover {
            background-color: #25a152;
            border-color: #25a152;
        }

    .btn-warning {
        background-color: #e77b85;
        border-color: #e77b85;
    }

        .btn-warning:hover {
            background-color: #c43f48;
            border-color: #c43f48;
        }

    .btn-info {
        background-color: #7583a0;
        border-color: #7583a0;
    }

        .btn-info:hover {
            background-color: #1b3488;
            border-color: #1b3488;
        }

    .btn-secondary {
        background-color: #25a152;
        border-color: #25a152;
    }

        .btn-secondary:hover {
            background-color: #8ba22e;
            border-color: #8ba22e;
        }

    .bi {
        margin-right: 10px;
    }

    .card-blue {
        background-color: #1b3488;
        color: white;
    }

    .card-green {
        background-color: #25a152;
        color: white;
    }

    .card-red {
        background-color: #c43f48;
        color: white;
    }

    .card-pink {
        background-color: #e77b85;
        color: white;
    }

    .card-gray {
        background-color: #7583a0;
        color: white;
    }
</style>

@{
    var rolUsuario = Context.Session.GetString("RolUsuario");
}

<div class="container py-5">
    <div class="row justify-content-center">

        @* Sólo para permisos de administrador *@
        @if (permisos.Contains("VerUsuarios"))
        {
            <div class="col-md-6 col-lg-4">
                <div class="card card-pink mb-3">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h3>@ViewBag.TotalUsuarios</h3>
                            <p>Usuarios Registrados</p>
                        </div>
                        <i class="bi bi-people-fill display-4"></i>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <a class="btn btn-light btn-sm w-100" asp-controller="Users" asp-action="Index">Más información <i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        }

        @if (permisos.Contains("VerProductos"))
        {
            <div class="col-md-6 col-lg-4">
                <div class="card card-green mb-3">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h3>@ViewBag.ProductosPorVencer</h3>
                            <p>Productos por vencer</p>
                        </div>
                        <i class="bi bi-box-seam display-4"></i>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <a class="btn btn-light btn-sm w-100" asp-controller="Productos" asp-action="Index">Más información <i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        }

        @if (permisos.Contains("VerRoles"))
        {
            <div class="col-md-6 col-lg-4">
                <div class="card card-gray mb-3">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h5>Roles</h5>
                            <p>Total: @ViewBag.TotalRoles</p>
                        </div>
                        <i class="bi bi-person-badge-fill display-4"></i>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <a class="btn btn-light btn-sm w-100" asp-controller="Roles" asp-action="Index">Ver Roles <i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        }

        @if (permisos.Contains("VerTipoMedicamentos"))
        {
            <div class="col-md-6 col-lg-4">
                <div class="card card-blue mb-3">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h5>Tipo Medicamentos</h5>
                            <p>Gestionar tipos disponibles</p>
                        </div>
                        <i class="bi bi-capsule-pill display-4"></i>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <a class="btn btn-light btn-sm w-100" asp-controller="Medicamentos" asp-action="Index">Ver Tipos <i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        }

        @if (permisos.Contains("VerReportes"))
        {
            <div class="col-md-6 col-lg-4">
                <div class="card card-gray mb-3">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h5>Reportes</h5>
                            <p>Ver reportes del sistema</p>
                        </div>
                        <i class="bi bi-file-earmark-text display-4"></i>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <a class="btn btn-light btn-sm w-100" asp-controller="Reporte" asp-action="Index">Ver Reportes <i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        }

        @if (permisos.Contains("VerVentas"))
        {
            <div class="col-md-6 col-lg-4">
                <div class="card card-red mb-3">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h5>Ventas</h5>
                            <p>Historial y gestión</p>
                        </div>
                        <i class="bi bi-cart-fill display-4"></i>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <a class="btn btn-light btn-sm w-100" asp-controller="Ventas" asp-action="Index">Ver Ventas <i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        }

        @if (permisos.Contains("AsignarPermisos"))
        {
            <div class="col-md-6 col-lg-4">
                <div class="card card-blue mb-3">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <div>
                            <h5>Permisos por Rol</h5>
                            <p>Asignar permisos personalizados</p>
                        </div>
                        <i class="bi bi-shield-lock display-4"></i>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <a class="btn btn-light btn-sm w-100" asp-controller="Roles" asp-action="Index">Asignar Permisos <i class="bi bi-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<div class="container mt-5">
    <h3 class="text-center mb-4">Ventas por Mes</h3>
    <canvas id="ventasChart" width="800" height="400"></canvas>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        fetch('/Home/ObtenerVentasPorMes')
            .then(response => response.json())
            .then(data => {
                const labels = data.map(item => item.mes);
                const valores = data.map(item => item.totalVentas);

                const ctx = document.getElementById('ventasChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Ventas',
                            data: valores,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
    </script>
}